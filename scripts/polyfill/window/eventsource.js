// https://github.com/remy/polyfills/blob/master/EventSource.js
!function(){var a=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,b=function(b){function h(){d._pollTimer=setTimeout(function(){i.call(d)},e)}function i(){try{if(d.readyState===d.CLOSED)return;var b=new XMLHttpRequest;b.open("GET",d.URL,!0),b.setRequestHeader("Accept","text/event-stream"),b.setRequestHeader("Cache-Control","no-cache"),b.setRequestHeader("X-Requested-With","XMLHttpRequest"),null!==f&&b.setRequestHeader("Last-Event-ID",f),g="",b.timeout=5e4,b.onreadystatechange=function(){if(3!==this.readyState&&4!==this.readyState||200!==this.status)d.readyState!==d.CLOSED&&(4===this.readyState?(d.readyState=d.CONNECTING,d.dispatchEvent("error",{type:"error"}),h()):0===this.readyState&&h());else{d.readyState===d.CONNECTING&&(d.readyState=d.OPEN,d.dispatchEvent("open",{type:"open"}));var b=this.responseText.substr(g.length).split("\n"),e=[],i=0,j="";for(g=this.responseText;i<b.length;i++)if(j=b[i].replace(a,""),0===j.indexOf("data"))e.push(j.replace(/data:?\s*/,""));else if(0===j.indexOf("id:"))f=j.replace(/id:?\s*/,"");else if(0===j.indexOf("id"))f=null;else if(""===j&&e.length){var k=new c(e.join("\n"),d.url,f);d.dispatchEvent("message",k),e=[]}4===this.readyState&&h()}},b.send(),setTimeout(function(){b.abort()},b.timeout),d._xhr=b}catch(e){d.dispatchEvent("error",{type:"error",data:e.message})}}var d=this,e=500,f=null,g="";if(!b||"string"!=typeof b)throw new SyntaxError("Not enough arguments");this.URL=b,this.readyState=this.CONNECTING,this._pollTimer=null,this._xhr=null,i()};b.prototype={close:function(){this.readyState=this.CLOSED,clearInterval(this._pollTimer),this._xhr.abort()},CONNECTING:0,OPEN:1,CLOSED:2,dispatchEvent:function(a,b){var c=this["_"+a+"Handlers"];if(c)for(var d=0;d<c.length;d++)c.call(this,b);this["on"+a]&&this["on"+a].call(this,b)},addEventListener:function(a,b){this["_"+a+"Handlers"]||(this["_"+a+"Handlers"]=[]),this["_"+a+"Handlers"].push(b)},removeEventListener:function(a,b){var c=this["_"+a+"Handlers"];if(c){for(var d=[],e=0,f=c.length;f>e;e++)c[e]!==b&&d.push(c[e]);this["_"+a+"Handlers"]=d}},onerror:null,onmessage:null,onopen:null,readyState:0,URL:""};var c=function(a,b,c){this.data=a,this.origin=b,this.lastEventId=c||""};c.prototype={data:null,type:"message",lastEventId:"",origin:""},window.EventSource=b}();