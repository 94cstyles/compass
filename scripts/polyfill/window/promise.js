// https://github.com/Octane/Promise
!function(a){"use strict";function p(a){this[f]=a}function q(a){return a instanceof p}function r(a){return Object(a)===a}function s(a){return"function"==typeof a}function t(a){return a instanceof E}function u(a){return a}function v(a){throw a}function w(a,b,c){a[d]||(a[d]=[],a[e]=[]),a[d].push(b),a[e].push(c)}function x(a){delete a[d],delete a[e]}function y(a){var b,c=a.length;for(b=0;c>b;b++)a[b]()}function z(a,b,c){var d=A(c);t(d)?d.then(a,b):q(d)?b(d[f]):a(c)}function A(a){var b;if(t(a))return a;if(r(a)){try{b=a.then}catch(c){return new p(c)}if(s(b))return new E(function(c,d){n(function(){try{b.call(a,c,d)}catch(e){d(e)}})})}return null}function B(a,c){function d(c){a[b]==g&&C(a,c)}function e(c){a[b]==g&&D(a,c)}try{c(d,e)}catch(f){e(f)}}function C(a,e){var g,j=A(e);t(j)?(a[b]=h,j.then(function(b){C(a,b)},function(b){D(a,b)})):q(j)?D(a,j[f]):(a[b]=i,a[c]=e,g=a[d],g&&g.length&&(x(a),y(g)))}function D(a,d){var f=a[e];a[b]=j,a[c]=d,f&&f.length&&(x(a),y(f))}function E(a){var d=this;if(!t(d))throw new TypeError(l);d[b]=g,d[c]=void 0,B(d,a)}var b="[[PromiseStatus]]",c="[[PromiseValue]]",d="[[OnFulfilled]]",e="[[OnRejected]]",f="[[OriginalError]]",g="pending",h="internal pending",i="fulfilled",j="rejected",k="not an array.",l='constructor Promise requires "new".',m="then() cannot return same Promise that it resolves.",n=a.setImmediate||require("timers").setImmediate,o=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)};E.prototype.then=function(a,d){var f,e=this;return a=s(a)?a:u,d=s(d)?d:v,f=new E(function(g,h){function k(a){var b;try{b=a(e[c])}catch(d){return void h(d)}b===f?h(new TypeError(m)):z(g,h,b)}function l(){n(k,a)}function o(){n(k,d)}switch(e[b]){case i:l();break;case j:o();break;default:w(e,l,o)}})},E.prototype["catch"]=function(a){return this.then(u,a)},E.resolve=function(a){var b=A(a);return t(b)?b:new E(function(c,d){q(b)?d(b[f]):c(a)})},E.reject=function(a){return new E(function(b,c){c(a)})},E.race=function(a){return new E(function(b,c){var d,e;if(o(a))for(e=a.length,d=0;e>d;d++)z(b,c,a[d]);else c(new TypeError(k))})},E.all=function(a){return new E(function(b,c){var g,h,i,j,d=0,e=0;if(o(a)){for(a=a.slice(0),h=a.length,j=0;h>j;j++)i=a[j],g=A(i),t(g)?(e++,g.then(function(c){return function(f){a[c]=f,d++,d==e&&b(a)}}(j),c)):q(g)?c(g[f]):a[j]=i;e||b(a)}else c(new TypeError(k))})},"undefined"!=typeof module&&module.exports?module.exports=a.Promise||E:a.Promise||(a.Promise=E)}(this);